units           real
atom_style      full
boundary        p p p
box             tilt large
comm_style      tiled 
pair_style      lj/cut/coul/long 14.0 14.0 
pair_modify     mix geometric
special_bonds   lj 0 0 0.5 coul 0 0 0.5
bond_style      harmonic
angle_style     harmonic
dihedral_style  opls
improper_style  cvff
#read_restart    restart.1
read_data       lmp.data
neighbor        2.0 bin
neigh_modify    delay 0
kspace_style    pppm 1e-6
kspace_modify   order 4 
variable    T equal 273      # run temperature
variable        tlo equal 258
variable        thi equal 288
variable    V equal vol
variable    dt equal 1.0
variable    p equal 400     # correlation length
variable    s equal 5       # sample interval
variable    d equal $p*$s   # dump interval
variable        outputname index 5OIL

# convert from LAMMPS real units to SI

variable    kB equal 1.3806504e-23    # [J/K] Boltzmann
variable    atm2Pa equal 101325.0
variable    kCal2J equal 4186.0/6.02214e23
variable    A2m equal 1.0e-10
variable    fs2s equal 1.0e-15
variable    convert equal ${atm2Pa}*${atm2Pa}*${fs2s}*${A2m}*${A2m}*${A2m}
variable    convert2 equal ${kCal2J}*${kCal2J}/${fs2s}/${A2m}

group pec6 type 4 5 6 7 8 9 10 11
group r32 type 1 2 3



thermo_style    custom step temp press density vol pe ke etotal
thermo       $d
thermo_modify   norm yes

minimize 1.0e-5 1.0e-7 100000 400000


write_data   system_after_eq1_min.data


timestep        1.0
dump dumpeq2 all custom 100 traj_eq2_reorient.lammpstrj id mol type x y z ix iy iz


fix fxnvt all nvt temp $T $T 100.0
run             1000000
undump dumpeq2
write_data   system_after_eq2_reorient.data
unfix fxnvt


variable dens equal density
variable h equal enthalpy
variable etot equal etotal
variable epot equal pe
variable ekin equal ke
fix densave all ave/time 100 1 100 v_dens file density_equilibration180.dat
dump dumpeq3 all custom 500 traj_eq3_npt.lammpstrj id mol type x y z ix iy iz
fix fxnpt all npt temp $T $T 100.0 iso 500.0 14.0 10000.0 

timestep        1.0
run             5000000

unfix fxnpt
unfix densave
undump dumpeq3

dump            dumpprod1 all custom 1000 r32.dump id type x y z vx vy vz ix iy iz
dump dumpprod2 all xyz 1000 r32.xyz

timestep        1.0

fix fxnpt all npt temp $T $T 100.0 iso 14.0 14.0 10000.0 

fix densave all ave/time 100 1 100 v_dens file density_production180.dat
fix hsave all ave/time 100 1 100 v_h file enthalpy_production.dat

run             5000000
unfix fxnpt
unfix densave
unfix hsave
undump dumpprod1
undump dumpprod2


write_data   system_after_eq3_npt.data



fix fxnvt2 all nvt temp $T $T 100.0
fix esave all ave/time 100 1 100 v_etot v_epot v_ekin file energy_production_${outputname}.dat
fix esave2 r32 ave/time 100 1 100 v_etot v_epot v_ekin file energy_production_r32_${outputname}.dat
fix esave3 pec6 ave/time 100 1 100 v_etot v_epot v_ekin file energy_production_pec6_${outputname}.dat
dump            dumpprod3 all custom 1000 ${outputname}.dump id type x y z vx vy vz ix iy iz
compute r32pec6 r32 group/group pec6
compute r32r32 r32 group/group r32
compute pec6pec6 pec6 group/group pec6
variable      interaction1 equal c_r32pec6[1]
variable      interaction2 equal c_r32r32[1]
variable      interaction3 equal c_pec6pec6[1]
fix interactionsave all ave/time 100 1 100 v_interaction1 v_interaction2 v_interaction3 file interaction_energy_${outputname}.dat
run            5000000
unfix fxnvt2
unfix esave
unfix esave2
unfix esave3
unfix interactionsave
undump dumpprod3


		  
fix       nveall 	all 	 	 	nve

reset_timestep 0
dump            dumpprod3 all dcd 1000 ${outputname}.dcd
dump_modify     dumpprod3 unwrap yes
dump            dumpprod4 all xtc 1000 ${outputname}.xtc
#viscosity calculation
# Define a compute to calculate the pressure tensor
compute       myPress all pressure NULL virial 

# Access the compute components (4=xy, 5=xz, 6=yz)
variable      pxy equal c_myPress[4]
variable      pxz equal c_myPress[5]
variable      pyz equal c_myPress[6]
fix          SS all ave/correlate $s $p $d &
             v_pxy v_pxz v_pyz type auto file S0St.dat ave running
fix myat2 all ave/time 1 1 1 v_pxy v_pxz v_pyz  &
    file stress.dat
variable     scale equal ${convert}/(${kB}*$T)*$V*$s*${dt}
variable     v11 equal trap(f_SS[3])*${scale}
variable     v22 equal trap(f_SS[4])*${scale}
variable     v33 equal trap(f_SS[5])*${scale}

#thermal conductivity calculation
compute      myKE all ke/atom
compute      myPE all pe/atom
compute      myStress all stress/atom NULL virial
compute      flux all heat/flux myKE myPE myStress
variable     Jx equal c_flux[1]/vol
variable     Jy equal c_flux[2]/vol
variable     Jz equal c_flux[3]/vol
fix          JJ all ave/correlate $s $p $d &
             c_flux[1] c_flux[2] c_flux[3] c_flux[4] c_flux[5] c_flux[6] type auto file J0Jt.dat ave running
variable     scale2 equal ${convert2}/${kB}/$T/$T/$V*$s*${dt}
variable     k11 equal trap(f_JJ[3])*${scale2}
variable     k22 equal trap(f_JJ[4])*${scale2}
variable     k33 equal trap(f_JJ[5])*${scale2}

thermo_style custom step temp press vol v_pxy v_pxz v_pyz v_v11 v_v22 v_v33 v_Jx v_Jy v_Jz v_k11 v_k22 v_k33
run          5000000

variable     v equal (v_v11+v_v22+v_v33)/3.0
variable     k equal (v_k11+v_k22+v_k33)/3.0
variable     ndens equal count(all)/vol

print        "average viscosity: $v [Pa.s] @ $T K, ${ndens} atoms/A^3"
print        "average conductivity: $k[W/mK] @ $T K, ${ndens} /A\^3"

unfix nveall
unfix JJ
unfix SS
undump dumpprod3
undump dumpprod4

variable hotend equal lz/10
variable coldend equal (lz/10)*5
variable coldend2 equal (lz/10)*6


# heat layers

region          hot block INF INF INF INF 0 ${hotend}
region          cold block  INF INF INF INF ${coldend} ${coldend2}
compute         Thot all temp/region hot
compute         Tcold all temp/region cold

# 1st equilibration run



# 2nd equilibration run

#fix             nveall all nve
#fix             hot all langevin ${thi} ${thi} 100.0 59804 tally yes
#fix             cold all langevin ${tlo} ${tlo} 100.0 287859 tally yes
#fix_modify      hot temp Thot
#fix_modify      cold temp Tcold

#variable        tdiff equal c_Thot-c_Tcold
#thermo_style    custom step temp c_Thot c_Tcold f_hot f_cold v_tdiff
#thermo_modify   colname c_Thot Temp_hot colname c_Tcold Temp_cold &
#                colname f_hot E_hot colname f_cold E_cold &
#                colname v_tdiff dTemp_step
#thermo          1000
#run             2000000

# thermal conductivity calculation
# reset langevin thermostats to zero energy accumulation

#compute         ke all ke/atom
#variable        temp atom c_ke/(1.5*v_kB) 

#fix             hot all langevin ${thi} ${thi} 100.0 59804 tally yes
#fix             cold all langevin ${tlo} ${tlo} 100.0 287859 tally yes
#fix_modify      hot temp Thot
#fix_modify      cold temp Tcold

#fix             ave all ave/time 10 100 1000 v_tdiff ave running
#thermo_style    custom step temp c_Thot c_Tcold f_hot f_cold v_tdiff f_ave
#thermo_modify   colname c_Thot Temp_hot colname c_Tcold Temp_cold &
#                colname f_hot E_hot colname f_cold E_cold &
#                colname v_tdiff dTemp_step colname f_ave dTemp

#compute         layers all chunk/atom bin/1d z lower 0.1 units reduced
#fix             2 all ave/chunk 10 100 1000 layers v_temp file profile.langevin

#variable start_time equal time
#variable kappa equal (0.5*${convert2}*(abs(f_hot)+abs(f_cold))/(time-${start_time})/(lx*ly)/2.0)*(lz/2.0)/f_ave

#run             20000000
#print           "Running average thermal conductivity: $(v_kappa:%.2f)"
